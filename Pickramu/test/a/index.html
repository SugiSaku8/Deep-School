<!DOCTYPE html>
<html>
<head>
    <title>Markdown Viewer</title>
    <style>
        /* スタイルはここに記述 */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div id="content">
        <!-- Markdownコンテンツがここに表示される -->
    </div>

    <script>
        function loadMarkdown(file) {
            fetch(file)
                .then(response => response.text())
                .then(markdown => {
                    const html = parseMarkdown(markdown);
                    document.getElementById('content').innerHTML = html;
                })
                .catch(error => console.error('Error loading markdown:', error));
        }

        function parseMarkdown(markdown) {
            // config, style, tag, scriptタグを除去
            markdown = markdown.replace(/@config \[open\]([\s\S]*?)@config \[close\]/g, '');
            markdown = markdown.replace(/@style \[open\]([\s\S]*?)@style \[close\]/g, (match, styleContent) => {
                return `<style>${styleContent}</style>`;
            });
            markdown = markdown.replace(/@tag (\w+) \[open\]([\s\S]*?)@tag \w+ \[close\]/g, (match, tagName, tagContent) => {
                return `<div id="${tagName}">${marked.parse(tagContent)}</div>`;
            });
            markdown = markdown.replace(/@btn id=(\w+) ([\s\S]*)/g, (match, btnId, btnContent) => {
                const content = btnContent.replace(/^id=/, '').trim();
                return `<button id="${btnId}">${content}</button>`;
            });
            markdown = markdown.replace(/@script on=(\w+) \[open\]([\s\S]*?)@script \[close\]/g, (match, onId, scriptContent) => {
                return `<script>
                            document.getElementById("${onId}").addEventListener("click", function() {
                                ${scriptContent}
                            });
                        <\/script>`;
            });
            // marked.jsを使用してMarkdownをHTMLに変換
            markdown = marked.parse(markdown);
            return markdown;
        }

        // ページのロード時にMarkdownファイルを読み込む
        window.onload = function() {
            loadMarkdown('test.md'); // Markdownファイルのパス
        };
    </script>
</body>
</html>