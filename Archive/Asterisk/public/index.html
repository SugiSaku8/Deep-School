<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="manifest" href="/manifest.json" />
    <link id="icon" rel="icon" href="/logo/Aterisk.ico" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Ã…sterisk</title>
  <meta property="analytics-track" content="Asterisk - Index/Tab" />
  <meta property="analytics-s-channel" content="homepage" />
  <meta property="analytics-s-bucket-0" content="Asterisk" />
  <meta property="analytics-s-bucket-1" content="Asterisk" />
  <meta property="analytics-s-bucket-2" content="Asterisk" />
  <meta name="Description" content="Asterisk" />
  <meta property="og:title" content="Asterisk" />
  <meta property="og:description" content="Asterisk" />
  <meta property="og:url" content="https://asterisk.jsjs8.repl.co/" />
  <meta property="og:locale" content="ja" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Asterisk" />
  <link rel="stylesheet" type="text/css" href="/astrerisk_ja.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
  <div id="hamburger">
    <input type="checkbox" id="checkbox" />
      <label class="burger" for="checkbox" onclick="toggleNav()">
      <button>
        <div class="container top">
          <div id="line" class="line top"></div>
        </div>
        <div class="container bottom">
          <div id="line" class="line bottom"></div>
        </div>
      </button>
    </label>
  </div>

  <nav id="nav">
    <ul>
      <li><a onclick="openandel()">æ–°ã—ã„æŠ•ç¨¿ã‚’ä½œã‚‹</a></li>
        <li><a onclick="loadStudyRoom()">å‹‰å¼·ç›¸è«‡å®¤ã‚’è¦‹ã‚‹</a></li>
        <li><a onclick="loadPlads()">æœªè§£æ±ºã®æŠ•ç¨¿ã‚’è¦‹ã‚‹</a></li>
      <li><a href="#">è¨­å®š</a></li>
      <li><a href="about.html">Asteriskã«ã¤ã„ã¦</a></li>
    </ul>
  </nav>

    <div class="search-container">
      <div class="search-box">
        <input
          type="text"
          id="search-input"
          placeholder="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›..."
        />
        <select id="genre-filter">
          <option value="">ã™ã¹ã¦ã®ã‚¸ãƒ£ãƒ³ãƒ«</option>
        </select>
        <button onclick="performSearch()" class="search-button">æ¤œç´¢</button>
      </div>
    </div>

    <div class="genre-tabs" id="genre-tabs"></div>

    <div id="welcome_main_screen">
      <div class="welcome_msg">ã•ã‚ã€å§‹ã‚ã‚ˆã†ã€‚</div>
      <div class="welcome_msg_minimal" style="text-align: center">
        <p style="width: 27%"></p>
        ã¯ã˜ã‚ã¾ã—ã¦ã€‚Ã…sterisk
      </div>
      <div style="display: flex">
        <br />
        <button class="singin_big">ã•ãã€ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦<br />å§‹ã‚ã‚ˆã†ã€‚</button>
    </div>
    </div>

  <div class="cookie" id="cookie">
      <p></p>
    <p class="Cookie_setting_msg">ã¾ãšã€CookieğŸªã®è¨­å®šã‚’ã—ã¦ãã ã•ã„ã€‚</p>
      <div style="display: flex">
        <button class="cookieonof" onclick="usecookie();">
          Cookiesã®ä½¿ç”¨ã‚’<br />è¨±å¯ã—ã¾ã™ã€‚
        </button>
        <button class="cookieonof" onclick="usecookie();">
          Cookiesã®ä½¿ç”¨ã‚’<br />æ‹’å¦ã—ã¾ã™ã€‚
        </button>
      </div>
      <p onclick="window.open('/help/cookie/ja')" class="">
        ä½•ã«Cookieã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ
      </p>
    </div>

  <div class="newandel" id="newandel">
      <div class="form-header">æ–°ã—ã„æŠ•ç¨¿ã‚’ä½œæˆ</div>
    <p>ã‚¿ã‚¤ãƒˆãƒ«:</p>
    <label>
        <textarea
          id="title"
          class="textbox-001"
          placeholder="æŠ•ç¨¿ã®ã‚¿ã‚¤ãƒˆãƒ«"
        ></textarea>
    </label>
    <p>ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</p>
    <label>
        <textarea
          id="user"
          class="textbox-001"
          placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
        ></textarea>
    </label>
    <p>ã‚¸ãƒ£ãƒ³ãƒ«:</p>
      <textarea
        id="genre"
        class="textbox-003"
        placeholder="ã‚¸ãƒ£ãƒ³ãƒ«"
      ></textarea>
    <p>å†…å®¹:</p>
    <label>
        <textarea
          id="naiyou"
          class="textbox-003"
          placeholder="æŠ•ç¨¿ã®å†…å®¹"
        ></textarea>
    </label>
      <div class="button-container">
        <button id="submit-button" onclick="submitPost()">é€ä¿¡ã™ã‚‹</button>
        <button id="cancel-button" onclick="closeAndel()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>

    <div id="loading" style="display: none">
      <div class="loader">èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>

    <div id="andel-container" class="andel-container"></div>
    <div
      id="plads-container"
      class="plads-container"
      style="display: none"
    ></div>

    <div id="error-message" class="error-message" style="display: none"></div>

    <style>
      .loader {
        text-align: center;
        padding: 20px;
        font-weight: bold;
      }

      .error-message {
        background: #ff5252;
        color: white;
        padding: 10px;
        text-align: center;
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 4px;
        z-index: 1000;
      }

      .search-container {
        padding: 20px;
        background: #f5f5f5;
        margin-bottom: 20px;
      }

      .search-box {
        display: flex;
        gap: 10px;
        max-width: 800px;
        margin: 0 auto;
      }

      .search-box input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .search-box select {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        min-width: 150px;
      }

      .search-button {
        background: #2196f3;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .search-button:hover {
        background: #1976d2;
      }

      .genre-tabs {
        display: flex;
        gap: 10px;
        padding: 10px 20px;
        overflow-x: auto;
        background: #fff;
        border-bottom: 1px solid #ddd;
      }

      .genre-tab {
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        white-space: nowrap;
        background: #f0f0f0;
        transition: background-color 0.3s;
      }

      .genre-tab:hover {
        background: #e0e0e0;
      }

      .genre-tab.active {
        background: #2196f3;
        color: white;
      }

      .plads-container {
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }

      .plads-card {
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .post-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .post-content {
        margin: 15px 0;
        white-space: pre-wrap;
      }

      .post-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #eee;
      }

      .resolve-button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .resolve-button:hover {
        background: #45a049;
      }

      .reply-section {
        margin-left: 20px;
        padding-left: 15px;
        border-left: 3px solid #e0e0e0;
      }

      .reply-form {
        margin: 10px 0;
        padding: 15px;
        background: #f5f5f5;
        border-radius: 8px;
      }

      .reply-form textarea {
        width: 100%;
        min-height: 60px;
        margin-bottom: 10px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
      }

      .reply-card {
        margin: 10px 0;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 4px;
        border-left: 3px solid #2196f3;
      }

      .search-highlight {
        background: yellow;
        padding: 2px;
      }
    </style>

  <script>
      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
      function toggleNav() {
        const nav = document.getElementById("nav");
        nav.classList.toggle("show");
      }

      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
      function showError(message) {
        const errorDiv = document.getElementById("error");
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
      }

      // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
      function showSuccess(message) {
        const successDiv = document.getElementById("success");
        successDiv.textContent = message;
        successDiv.style.display = "block";
      }

      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
      function toggleLoading(show) {
        const loading = document.getElementById("loading");
        loading.style.display = show ? "block" : "none";
      }

      // æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
      function openandel() {
        document.getElementById("newandel").style.display = "block";
      }

      // æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹
      function closeAndel() {
      document.getElementById("newandel").style.display = "none";
    }

      // æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹
      function clearForm() {
        document.getElementById("title").value = "";
        document.getElementById("username").value = "";
        document.getElementById("genre").value = "";
        document.getElementById("content").value = "";
      }

      // æŠ•ç¨¿ã‚’é€ä¿¡ã™ã‚‹
      async function submitPost() {
        const title = document.getElementById("title").value;
        const username = document.getElementById("username").value;
        const genre = document.getElementById("genre").value;
        const content = document.getElementById("content").value;

        if (!title || !username || !genre || !content) {
          showError("å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        toggleLoading(true);

        try {
          const response = await fetch("/send", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              title,
              username,
              genre,
              content,
            }),
          });

          const result = await response.json();
          if (result.status === "success") {
            showSuccess(result.message);
            closeAndel();
            clearForm();
            await loadGenrePosts(genre);
          } else {
            showError(result.message);
          }
        } catch (error) {
          console.error("Error:", error);
          showError("æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        } finally {
          toggleLoading(false);
        }
      }

      // è¿”ä¿¡ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
      function toggleReplyForm(postId) {
        const replyForm = document.getElementById("reply-form-" + postId);
        replyForm.style.display =
          replyForm.style.display === "none" ? "block" : "none";
      }

      // è¿”ä¿¡ã‚’é€ä¿¡ã™ã‚‹
      async function submitReply(parentId, genre) {
        const username = document.getElementById(
          "reply-username-" + parentId
        ).value;
        const content = document.getElementById(
          "reply-content-" + parentId
        ).value;

        if (!username || !content) {
          showError("å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        toggleLoading(true);

        try {
          const response = await fetch("/send", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              username,
              content,
              parentId,
              genre,
            }),
          });

          const result = await response.json();
          if (result.status === "success") {
            showSuccess(result.message);
            toggleReplyForm(parentId);
            document.getElementById("reply-username-" + parentId).value = "";
            document.getElementById("reply-content-" + parentId).value = "";
            await loadReplies(parentId, genre);
          } else {
            showError(result.message);
          }
        } catch (error) {
          console.error("Error:", error);
          showError("æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        } finally {
          toggleLoading(false);
        }
      }

      // ã‚¸ãƒ£ãƒ³ãƒ«ã‚’èª­ã¿è¾¼ã‚€
      async function loadGenres() {
        try {
          const response = await fetch("/genres");
          const result = await response.json();

          if (result.status === "success") {
            const genreDropdown = document.getElementById("genre");
            result.data.forEach((genre) => {
              const option = document.createElement("option");
              option.value = genre;
              option.textContent = genre;
              genreDropdown.appendChild(option);
            });
          } else {
            showError("ã‚¸ãƒ£ãƒ³ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
          }
        } catch (error) {
          console.error("Error:", error);
          showError("ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        }
      }

      // ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠã™ã‚‹
      async function selectGenre(genre) {
        document.querySelectorAll(".genre-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.getElementById("search-input").value = "";
        document
          .getElementById("search-input")
          .dispatchEvent(new Event("input"));

        // ã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ãƒ–ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
        if (genre === "") {
          document
            .querySelector(".genre-tab:first-child")
            .classList.add("active");
        } else {
          const tabs = document.querySelectorAll(".genre-tab");
          for (let tab of tabs) {
            if (tab.textContent.trim() === genre) {
              tab.classList.add("active");
              break;
            }
          }
        }

        await loadGenrePosts(genre);
      }

      // ã‚¸ãƒ£ãƒ³ãƒ«ã®æŠ•ç¨¿ã‚’èª­ã¿è¾¼ã‚€
      async function loadGenrePosts(genre) {
        toggleLoading(true);
        try {
          const response = await fetch("/posts/" + genre);
          const result = await response.json();

          if (result.status === "success") {
            const container = document.getElementById("andel-container");
            document.getElementById("plads-container").style.display = "none";
            container.style.display = "block";
            container.innerHTML = "<h2>" + genre + "ã®æŠ•ç¨¿</h2>";

            if (result.data.length === 0) {
              container.innerHTML +=
                '<div class="no-results">æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
            } else {
              result.data.forEach((post) => createPostElement(post, container));
            }
      } else {
            showError("æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
          }
        } catch (error) {
          console.error("Error:", error);
          showError("ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        } finally {
          toggleLoading(false);
        }
      }

      // æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹
      async function performSearch() {
        const query = document.getElementById("search-input").value;
        if (!query) {
          showError("æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        toggleLoading(true);
        try {
          const response = await fetch("/search/" + query);
          const result = await response.json();

          if (result.status === "success") {
            const container = document.getElementById("andel-container");
            document.getElementById("plads-container").style.display = "none";
            container.style.display = "block";
            container.innerHTML = "<h2>æ¤œç´¢çµæœ</h2>";

            if (result.data.length === 0) {
              container.innerHTML +=
                '<div class="no-results">è©²å½“ã™ã‚‹æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
            } else {
              result.data.forEach((post) => createPostElement(post, container));
            }
      } else {
            showError("æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
          }
        } catch (error) {
          console.error("Error:", error);
          showError("ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        } finally {
          toggleLoading(false);
        }
      }

      // ã‚¯ãƒƒã‚­ãƒ¼ã®ä½¿ç”¨ã‚’è¨±å¯ã™ã‚‹
      function usecookie() {
        document.getElementById("cookie").style.display = "none";
        document.cookie = "cookieconsent=1; max-age=31536000; path=/";
      }

      // ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker.register("/sw.js").then(
            function (registration) {
              console.log(
                "Service Worker registered with scope:",
                registration.scope
              );
            },
            function (err) {
              console.log("Service Worker registration failed:", err);
            }
          );
        });
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", async () => {
        document.getElementById("newandel").style.display = "none";
        await loadGenres();
        await loadGenrePosts("");
        document
          .getElementById("search-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              performSearch();
            }
          });
      });
  </script>
</body>
</html>
