<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koodi Studio テスト</title>
    
    <!-- CodeMirror のスタイルとテーマ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        #app-root {
            height: 100vh;
            width: 100vw;
        }
        
        /* 読み込み中のスタイル */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.2rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="app-root">
        <div class="loading">Koodi Studio を読み込み中...</div>
    </div>
    
    <!-- CodeMirror のスクリプト -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/display/placeholder.min.js"></script>
    
    <!-- アプリケーションのスクリプト -->
    <script type="module">
        import { appInit } from './js/apps/koodistudio.js';
        
        // モックのシェルオブジェクト
        const mockShell = {
            log: console.log,
            error: console.error,
            // 必要に応じて他のメソッドを追加
            addEventListener: () => {},
            removeEventListener: () => {},
            dispatchEvent: () => {}
        };
        
        // アプリを初期化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing Koodi Studio...');
            try {
                appInit(mockShell);
                console.log('Koodi Studio initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Koodi Studio:', error);
                document.getElementById('app-root').innerHTML = `
                    <div style="padding: 20px; color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; margin: 20px;">
                        <h2>エラーが発生しました</h2>
                        <p>Koodi Studio の初期化中にエラーが発生しました。</p>
                        <pre style="background: #f1f1f1; padding: 10px; border-radius: 4px; overflow-x: auto;">${error.stack || error.message || '不明なエラー'}</pre>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
